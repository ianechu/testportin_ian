<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Gesportin - Test Suite</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family:
          -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          "Helvetica Neue", Arial, sans-serif;
        background: #f5f5f5;
        padding: 40px 20px;
        color: #333;
      }

      .container {
        max-width: 600px;
        margin: 0 auto;
      }

      header {
        text-align: center;
        margin-bottom: 50px;
      }

      h1 {
        font-size: 2rem;
        margin-bottom: 10px;
        font-weight: 700;
      }

      .subtitle {
        font-size: 1rem;
        color: #666;
        font-weight: 300;
      }

      .setup-section {
        background: white;
        padding: 20px;
        border-radius: 6px;
        margin-bottom: 30px;
        border: 2px solid #ff6b6b;
      }

      .setup-section h2 {
        font-size: 1rem;
        margin-bottom: 12px;
        color: #ff6b6b;
      }

      .setup-button {
        display: block;
        width: 100%;
        padding: 14px 20px;
        background: #ff6b6b;
        color: white;
        border: none;
        border-radius: 6px;
        font-size: 0.95rem;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s ease;
      }

      .setup-button:hover:not(:disabled) {
        background: #ff5252;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(255, 107, 107, 0.3);
      }

      .setup-button:disabled {
        background: #ccc;
        cursor: not-allowed;
      }

      .setup-status {
        margin-top: 12px;
        padding: 12px;
        background: #f5f5f5;
        border-radius: 4px;
        font-size: 0.85rem;
        color: #666;
        max-height: 200px;
        overflow-y: auto;
        font-family: monospace;
      }

      .setup-status.active {
        background: #e8f5e9;
        color: #2e7d32;
      }

      .setup-status.error {
        background: #ffebee;
        color: #c62828;
      }

      .summary {
        margin-top: 12px;
        padding: 12px;
        background: #e3f2fd;
        border-radius: 4px;
        font-size: 0.85rem;
        color: #1565c0;
      }

      .divider {
        height: 2px;
        background: #0b74de;
        margin: 30px 0;
      }

      .grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 12px;
      }

      a {
        display: block;
        padding: 14px 20px;
        background: white;
        color: #0b74de;
        text-decoration: none;
        border: 1px solid #e0e0e0;
        border-radius: 6px;
        font-size: 0.95rem;
        font-weight: 500;
        transition: all 0.2s ease;
        text-align: left;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .count {
        font-size: 0.85rem;
        color: #999;
        font-weight: 400;
      }

      a:hover {
        background: #0b74de;
        color: white;
        border-color: #0b74de;
        transform: translateX(4px);
      }

      a:hover .count {
        color: #e0e0e0;
      }

      footer {
        text-align: center;
        margin-top: 50px;
        font-size: 0.85rem;
        color: #999;
      }

      @media (max-width: 480px) {
        h1 {
          font-size: 1.5rem;
        }

        .container {
          padding: 0 10px;
        }
      }
    </style>
  </head>

  <body>
    <div class="container">
      <header>
        <h1>Gesportin</h1>
        <p class="subtitle">Suite de Tests para API REST</p>
        <p class="subtitle">El orden de creaci√≥n SI importa</p>
      </header>

      <div class="divider"></div>

      <div class="setup-section">
        <h2>‚öôÔ∏è Configuraci√≥n Inicial</h2>
        <button class="setup-button" id="btnSetup">Crear datos de prueba (tipousuario ‚Üí 50 roles ‚Üí 100 de cada tabla)</button>
        <div class="setup-status" id="setupStatus"></div>
      </div>

      <div class="grid">
        <a href="club.html">
          <span>‚öΩ Club</span>
          <span class="count" id="count-club">-</span>
        </a>
        <a href="rolusuario.html">
          <span>üé≠ Rol Usuario</span>
          <span class="count" id="count-rolusuario">-</span>
        </a>
        <a href="tipousuario.html">
          <span>üëî Tipo Usuario</span>
          <span class="count" id="count-tipousuario">-</span>
        </a>

        <a href="usuario.html">
          <span>üë® Usuario</span>
          <span class="count" id="count-usuario">-</span>
        </a>

        <a href="noticia.html">
          <span>üì∞ Noticia</span>
          <span class="count" id="count-noticia">-</span>
        </a>
        <a href="comentario.html">
          <span>üí¨ Comentario</span>
          <span class="count" id="count-comentario">-</span>
        </a>

        <a href="puntuacion.html">
          <span>‚≠ê Puntuaci√≥n</span>
          <span class="count" id="count-puntuacion">-</span>
        </a>

        <a href="tipoarticulo.html">
          <span>üè∑Ô∏è Tipo Art√≠culo</span>
          <span class="count" id="count-tipoarticulo">-</span>
        </a>

        <a href="articulo.html">
          <span>üì¶ Art√≠culo</span>
          <span class="count" id="count-articulo">-</span>
        </a>

        <a href="comentarioart.html">
          <span>üí¨ Comentario Art√≠culo</span>
          <span class="count" id="count-comentarioart">-</span>
        </a>

        <a href="carrito.html">
          <span>üõí Carrito</span>
          <span class="count" id="count-carrito">-</span>
        </a>

        <a href="factura.html">
          <span>üìÑ Factura</span>
          <span class="count" id="count-factura">-</span>
        </a>

        <a href="compra.html">
          <span>üõçÔ∏è Compra</span>
          <span class="count" id="count-compra">-</span>
        </a>

        <a href="temporada.html">
          <span>üìÖ Temporada</span>
          <span class="count" id="count-temporada">-</span>
        </a>

        <a href="categoria.html">
          <span>üìÇ Categor√≠a</span>
          <span class="count" id="count-categoria">-</span>
        </a>
        <a href="equipo.html">
          <span>üë• Equipo</span>
          <span class="count" id="count-equipo">-</span>
        </a>
        <a href="liga.html">
          <span>üèÜ Liga</span>
          <span class="count" id="count-liga">-</span>
        </a>

        <a href="partido.html">
          <span>‚öîÔ∏è Partido</span>
          <span class="count" id="count-partido">-</span>
        </a>

        <a href="jugador.html">
          <span>üë§ Jugador</span>
          <span class="count" id="count-jugador">-</span>
        </a>

        <a href="cuota.html">
          <span>üí∞ Cuota</span>
          <span class="count" id="count-cuota">-</span>
        </a>

        <a href="pago.html">
          <span>üí≥ Pago</span>
          <span class="count" id="count-pago">-</span>
        </a>
      </div>

      <footer>
        <p>Selecciona un endpoint para ejecutar los tests</p>
      </footer>
    </div>

    <script>
      const endpoints = [
        "articulo",
        "carrito",
        "categoria",
        "club",
        "comentario",
        "comentarioart",
        "compra",
        "cuota",
        "equipo",
        "factura",
        "jugador",
        "liga",
        "noticia",
        "pago",
        "partido",
        "puntuacion",
        "rolusuario",
        "temporada",
        "tipoarticulo",
        "tipousuario",
        "usuario",
      ];

      const baseUrl = "http://localhost:8089";

      // Tabla de orden de creaci√≥n y cantidad
      const setupOrder = [
        { name: "tipousuario", quantity: 1, endpoint: "tipousuario", method: "GET", path: "/fill" },
        { name: "rolusuario", quantity: 50, endpoint: "rolusuario", method: "POST", path: "/fill" },
        { name: "club", quantity: 100, endpoint: "club", method: "POST", path: "/fill/100" },
        { name: "usuario", quantity: 100, endpoint: "usuario", method: "POST", path: "/fill/100" },
        { name: "noticia", quantity: 100, endpoint: "noticia", method: "POST", path: "/fill/100" },
        { name: "comentario", quantity: 100, endpoint: "comentario", method: "POST", path: "/fill/100" },
        { name: "puntuacion", quantity: 100, endpoint: "puntuacion", method: "POST", path: "/fill/100" },
        { name: "tipoarticulo", quantity: 100, endpoint: "tipoarticulo", method: "POST", path: "/fill/100" },
        { name: "articulo", quantity: 100, endpoint: "articulo", method: "POST", path: "/fill/100" },
        { name: "comentarioart", quantity: 100, endpoint: "comentarioart", method: "POST", path: "/fill/100" },
        { name: "temporada", quantity: 100, endpoint: "temporada", method: "POST", path: "/fill/100" },
        { name: "categoria", quantity: 100, endpoint: "categoria", method: "POST", path: "/fill/100" },
        { name: "equipo", quantity: 100, endpoint: "equipo", method: "POST", path: "/fill/100" },
        { name: "liga", quantity: 100, endpoint: "liga", method: "POST", path: "/fill/100" },
        { name: "partido", quantity: 100, endpoint: "partido", method: "POST", path: "/fill/100" },
        { name: "jugador", quantity: 100, endpoint: "jugador", method: "POST", path: "/fill/100" },
        { name: "cuota", quantity: 100, endpoint: "cuota", method: "POST", path: "/fill/100" },
        { name: "carrito", quantity: 100, endpoint: "carrito", method: "POST", path: "/fill/100" },
        { name: "factura", quantity: 100, endpoint: "factura", method: "POST", path: "/fill/100" },
        { name: "compra", quantity: 100, endpoint: "compra", method: "POST", path: "/fill/100" },
        { name: "pago", quantity: 100, endpoint: "pago", method: "POST", path: "/fill/100" },
      ];

      async function fetchCount(endpoint) {
        try {
          const res = await fetch(`${baseUrl}/${endpoint}/count`);
          if (!res.ok) return "?";
          const count = await res.json();
          return count > 0 ? count.toString() : "0";
        } catch (e) {
          return "?";
        }
      }

      async function loadCounts() {
        for (const endpoint of endpoints) {
          const count = await fetchCount(endpoint);
          const el = document.getElementById(`count-${endpoint}`);
          if (el) el.textContent = count;
        }
      }

      function log(message, isError = false) {
        const statusEl = document.getElementById("setupStatus");
        const timestamp = new Date().toLocaleTimeString();
        const line = `[${timestamp}] ${message}`;
        statusEl.textContent = line + "\n" + statusEl.textContent;
        statusEl.classList.toggle("error", isError);
        statusEl.classList.add("active");
      }

      async function setupData() {
        const btn = document.getElementById("btnSetup");
        const statusEl = document.getElementById("setupStatus");
        btn.disabled = true;
        statusEl.innerHTML = "";

        log("Iniciando configuraci√≥n inicial...");

        const results = {};

        for (const item of setupOrder) {
          try {
            const url = `${baseUrl}/${item.endpoint}${item.path}`;
            log(`Creando ${item.quantity} ${item.name}...`);
            
            const response = await fetch(url, {
              method: item.method,
              headers: { "Content-Type": "application/json" },
            });

            if (!response.ok) {
              throw new Error(`HTTP ${response.status}`);
            }

            results[item.name] = item.quantity;
            log(`‚úì ${item.name}: ${item.quantity} registros creados`);
          } catch (e) {
            log(`‚úó Error creando ${item.name}: ${e.message}`, true);
            results[item.name] = 0;
          }
        }

        // Mostrar resumen
        log("----------------------------------------");
        log("Resumen de creaci√≥n:");
        log("----------------------------------------");

        let totalRecords = 0;
        for (const item of setupOrder) {
          const count = results[item.name] || 0;
          totalRecords += count;
          log(`${item.name}: ${count} registros`);
        }

        log("----------------------------------------");
        log(`Total: ${totalRecords} registros`);
        log("----------------------------------------");
        log("‚úì Configuraci√≥n completada");

        // Recargar contadores
        await loadCounts();
        btn.disabled = false;
      }

      document.getElementById("btnSetup").addEventListener("click", setupData);
      window.addEventListener("load", loadCounts);
    </script>
  </body>
</html>
